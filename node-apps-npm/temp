const mongojs = require('mongojs')

//connecting to mongo db with collection
//mongojs('connectionString') ; incase localhost /default port is taken automaticall
const db = mongojs('booksdb')
const books = db.collection('books')

class BookService {
    constructor() { }
    findAll() {
        return new Promise((resolve, reject) => {
            db.books.find((err, docs) => {
                if (err) {
                    reject(err)
                }
                resolve(docs);
            });
        });

    }
}
module.exports = new BookService();

const { findAll } = require('../services/BookService');
const express = require('express');
const router = express.Router();

router.get('/list', async (req, res) => {
    try {
        const books = await findAll();
        res.status(200).json(books)
    }
    catch (err) {
        res.status(400).json({ message: 'Books Not found' })
    }
});

module.exports = router;

const express = require('express');
const MessageRouter = require('./routers/messagerouter');
const BooksRouter = require('./routers/booksrouer');

const { log } = console;
const port = 3000;
//create application object
const app = express();
//connect Routers with application object
app.use('/api/message',MessageRouter)
app.use('/api/books',BooksRouter);


app.get('/', (request, response) => {
    response.end('Home')
});
//start server
app.listen(port, () => {
    log('Express server is running @', port);
});
